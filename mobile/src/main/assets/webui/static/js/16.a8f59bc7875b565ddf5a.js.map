{"version":3,"sources":["webpack:///./src/util/time.js","webpack:///./src/queries.js","webpack:///./src/views/ActivityAndroid.vue?039d","webpack:///src/views/ActivityAndroid.vue","webpack:///./src/views/ActivityAndroid.vue?fd77","webpack:///./src/views/ActivityAndroid.vue"],"names":["__webpack_require__","r","__webpack_exports__","moment__WEBPACK_IMPORTED_MODULE_0__","moment__WEBPACK_IMPORTED_MODULE_0___default","n","seconds_to_duration","seconds","result","hrs","Math","floor","min","sec","get_day_start","datestr","datestart","moment","set","get_prev_day","add","get_next_day","querystr_to_array","querystr","split","filter","l","map","appnames","chrome","firefox","opera","brave","summaryQuery","windowbucket","afkbucket","count","replace","concat","windowQuery","appcount","titlecount","filterAFK","browserSummaryQuery","browserbuckets","limit","lodash_map__WEBPACK_IMPORTED_MODULE_2___default","b","code","lodash_each__WEBPACK_IMPORTED_MODULE_1___default","browserName","bucketId","lodash_filter__WEBPACK_IMPORTED_MODULE_0___default","buckets","indexOf","undefined","appnames_str","JSON","stringify","appQuery","appbucket","dailyActivityQuery","dailyActivityQueryAndroid","androidbucket","editorActivityQuery","editorbucket","_queryDailyActivity","_queryApps","views_ActivityAndroidvue_type_script_lang_js_","name","data","today","moment_default","startOf","format","errormsg","total_duration","daily_activity","top_apps","top_apps_count","top_apps_namefunc","e","app","top_apps_colorfunc","appBucketId","watch","$route","this","refresh","computed","host","params","date","dateParam","dateStart","dateEnd","dateShort","mounted","testError","methods","previousDay","subtract","nextDay","setDate","$router","push","queryAll","errorHandler","error","eventcount","queryApps","queryDailyActivity","asyncToGenerator_default","regenerator_default","a","mark","_callee","periods","q","wrap","_context","prev","next","queries","$aw","query","sent","stop","apply","arguments","_callee2","timeperiods","i","startdate","enddate","dur_per_date","_context2","map_default","zip_default","t","timestamp","duration","status","console","log","component","Object","componentNormalizer","_vm","_h","$createElement","_c","_self","_v","_s","_f","attrs","variant","show","length","staticClass","to","disabled","id","type","max","domProps","value","on","change","$event","target","click","periodusage_arr","fields","namefunc","colorfunc","size"],"mappings":"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","file":"static/js/16.a8f59bc7875b565ddf5a.js","sourcesContent":["import moment from 'moment';\n\nexport default {\n    seconds_to_duration(seconds) {\n        var result = \"\";\n        var hrs = Math.floor(seconds/60/60);\n        var min = Math.floor(seconds/60%60);\n        var sec = Math.floor(seconds%60);\n        if (hrs != 0)\n            result += hrs + \"h\";\n        if (hrs != 0 || min != 0)\n            result += min + \"m\";\n        if (hrs == 0)\n            result += sec + \"s\";\n        return result;\n    },\n\n    get_day_start(datestr) {\n      // Get start time of date\n      var datestart = moment(datestr);\n      datestart.set('hour', 0);\n      datestart.set('minute', 0);\n      datestart.set('second', 0);\n      datestart.set('millisecond', 0);\n      return datestart;\n    },\n\n    get_prev_day(datestr){\n      var newdate = moment(datestr).add(-1, 'days');\n      return newdate;\n    },\n\n    get_next_day(datestr){\n      var newdate = moment(datestr).add(1, 'days');\n      return newdate;\n    },\n}\n","import _ from \"lodash\";\n\n// TODO: Sanitize string input of buckets\n\nfunction querystr_to_array(querystr) {\n  return querystr\n    .split(\";\")\n    .filter(l => l)\n    .map(l => l + \";\");\n}\n\nexport function summaryQuery(windowbucket, afkbucket, count) {\n  windowbucket = windowbucket.replace('\"', '\\\\\"');\n  afkbucket = afkbucket.replace('\"', '\\\\\"');\n  let code = `events  = flood(query_bucket(\"${windowbucket}\"));\n    not_afk = flood(query_bucket(\"${afkbucket}\"));\n    not_afk = filter_keyvals(not_afk, \"status\", [\"not-afk\"]);\n    events  = filter_period_intersect(events, not_afk);\n    title_events  = merge_events_by_keys(events, [\"app\", \"title\"]);\n    title_events  = sort_by_duration(title_events);\n    app_events  = merge_events_by_keys(title_events, [\"app\"]);\n    app_events  = sort_by_duration(app_events);\n    app_events  = limit_events(app_events, ${count});\n    title_events  = limit_events(title_events, ${count});\n    RETURN  = {\"app_events\": app_events, \"title_events\": title_events};`;\n  return querystr_to_array(code);\n}\n\nexport function windowQuery(\n  windowbucket,\n  afkbucket,\n  appcount,\n  titlecount,\n  filterAFK\n) {\n  windowbucket = windowbucket.replace('\"', '\\\\\"');\n  afkbucket = afkbucket.replace('\"', '\\\\\"');\n  let code =\n    `events  = flood(query_bucket(\"${windowbucket}\"));\n     not_afk = flood(query_bucket(\"${afkbucket}\"));\n     not_afk = filter_keyvals(not_afk, \"status\", [\"not-afk\"]);` +\n    (filterAFK ? \"events  = filter_period_intersect(events, not_afk);\" : \"\") +\n    `title_events  = merge_events_by_keys(events, [\"app\", \"title\"]);\n    title_events  = sort_by_duration(title_events);\n    app_events  = merge_events_by_keys(title_events, [\"app\"]);\n    app_events  = sort_by_duration(app_events);\n\n    events = sort_by_timestamp(events);\n    app_chunks = chunk_events_by_key(events, \"app\");\n    app_events  = limit_events(app_events, ${appcount});\n    title_events  = limit_events(title_events, ${titlecount});\n    duration = sum_durations(events);\n    RETURN  = {\"app_events\": app_events, \"title_events\": title_events, \"app_chunks\": app_chunks, \"duration\": duration};`;\n  return querystr_to_array(code);\n}\n\nexport function appQuery(appbucket, limit) {\n  appbucket = appbucket.replace('\"', '\\\\\"');\n  limit = limit || 5;\n  let code =\n    `events  = query_bucket(\"${appbucket}\");` +\n    `events  = merge_events_by_keys(events, [\"app\"]);\n    events  = sort_by_duration(events);\n    events  = limit_events(events, ${limit});\n    total_duration = sum_durations(events);\n    RETURN  = {\"events\": events, \"total_duration\": total_duration};`;\n  return querystr_to_array(code);\n}\n\nconst appnames = {\n  chrome: [\n    \"Google-chrome\",\n    \"chrome.exe\",\n    \"Chromium\",\n    \"Google Chrome\",\n    \"Chromium-browser\",\n    \"Chromium-browser-chromium\",\n    \"Google-chrome-beta\",\n    \"Google-chrome-unstable\"\n  ],\n  firefox: [\n    \"Firefox\",\n    \"Firefox.exe\",\n    \"firefox\",\n    \"firefox.exe\",\n    \"Firefox Developer Edition\",\n    \"Firefox Beta\",\n    \"Nightly\"\n  ],\n  opera: [\"opera.exe\", \"Opera\"],\n  brave: [\"brave.exe\"]\n};\n\nexport function browserSummaryQuery(\n  browserbuckets,\n  windowbucket,\n  afkbucket,\n  limit,\n  filterAFK\n) {\n  // Escape `\"`\n  browserbuckets = _.map(browserbuckets, b => b.replace('\"', '\\\\\"'));\n  windowbucket = windowbucket.replace('\"', '\\\\\"');\n  afkbucket = afkbucket.replace('\"', '\\\\\"');\n  limit = limit || 5;\n\n  // If multiple browser buckets were found\n  let code =\n    `events = [];\n     window = flood(query_bucket(\"${windowbucket}\"));` +\n    (filterAFK\n      ? `not_afk = flood(query_bucket(\"${afkbucket}\"));\n     not_afk = filter_keyvals(not_afk, \"status\", [\"not-afk\"]);`\n      : \"\");\n\n  _.each([\"chrome\", \"firefox\", \"opera\", \"brave\"], browserName => {\n    let bucketId = _.filter(\n      browserbuckets,\n      buckets => buckets.indexOf(browserName) !== -1\n    )[0];\n    if (bucketId === undefined) {\n      // Skip browser if specific bucket not available\n      return;\n    }\n    let appnames_str = JSON.stringify(appnames[browserName]);\n    code +=\n      `events_${browserName} = flood(query_bucket(\"${bucketId}\"));\n       window_${browserName} = filter_keyvals(window, \"app\", ${appnames_str});` +\n      (filterAFK\n        ? `window_${browserName} = filter_period_intersect(window_${browserName}, not_afk);`\n        : \"\") +\n      `events_${browserName} = filter_period_intersect(events_${browserName}, window_${browserName});\n       events_${browserName} = split_url_events(events_${browserName});\n       events = sort_by_timestamp(concat(events, events_${browserName}));`;\n  });\n\n  return querystr_to_array(code).concat([\n    'urls = merge_events_by_keys(events, [\"url\"]);',\n    \"urls = sort_by_duration(urls);\",\n    \"urls = limit_events(urls, \" + limit + \");\",\n    \"domains = split_url_events(events);\",\n    'domains = merge_events_by_keys(domains, [\"domain\"]);',\n    \"domains = sort_by_duration(domains);\",\n    \"domains = limit_events(domains, \" + limit + \");\",\n    'chunks = chunk_events_by_key(events, \"domain\");',\n    \"duration = sum_durations(events);\",\n    'RETURN = {\"domains\": domains, \"urls\": urls, \"chunks\": chunks, \"duration\": duration};'\n  ]);\n}\n\nexport function editorActivityQuery(editorbucket, limit) {\n  editorbucket = editorbucket.replace('\"', '\\\\\"');\n  return [\n    'editorbucket = \"' + editorbucket + '\";',\n    \"events = flood(query_bucket(editorbucket));\",\n    'files = sort_by_duration(merge_events_by_keys(events, [\"file\", \"language\"]));',\n    \"files = limit_events(files, \" + limit + \");\",\n    'languages = sort_by_duration(merge_events_by_keys(events, [\"language\"]));',\n    \"languages = limit_events(languages, \" + limit + \");\",\n    'projects = sort_by_duration(merge_events_by_keys(events, [\"project\"]));',\n    \"projects = limit_events(projects, \" + limit + \");\",\n    \"duration = sum_durations(events);\",\n    'RETURN = {\"files\": files, \"languages\": languages, \"projects\": projects, \"duration\": duration};'\n  ];\n}\n\nexport function dailyActivityQuery(afkbucket) {\n  afkbucket = afkbucket.replace('\"', '\\\\\"');\n  return [\n    'afkbucket = \"' + afkbucket + '\";',\n    \"not_afk = flood(query_bucket(afkbucket));\",\n    'not_afk = merge_events_by_keys(not_afk, [\"status\"]);',\n    \"RETURN = not_afk;\"\n  ];\n}\n\nexport function dailyActivityQueryAndroid(androidbucket) {\n  androidbucket = androidbucket.replace('\"', '\\\\\"');\n  return [\n    `events = query_bucket(\"${androidbucket}\");`,\n    \"RETURN = sum_durations(events);\"\n  ];\n}\n\nexport default {\n  summaryQuery,\n  windowQuery,\n  browserSummaryQuery,\n  appQuery,\n  dailyActivityQuery,\n  dailyActivityQueryAndroid,\n  editorActivityQuery\n};\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('h2',[_vm._v(\"Activity for \"+_vm._s(_vm.dateShort))]),_c('p',[_vm._v(\"Device type: Android\"),_c('br'),_vm._v(\"Host: \"+_vm._s(_vm.host)),_c('br'),_vm._v(\"Active time: \"+_vm._s(_vm._f(\"friendlyduration\")(_vm.total_duration)))]),_c('b-alert',{attrs:{\"variant\":\"danger\",\"show\":_vm.errormsg.length > 0}},[_vm._v(_vm._s(_vm.errormsg))]),_c('div',{staticClass:\"d-flex\"},[_c('div',{staticClass:\"p-1\"},[_c('b-button-group',[_c('b-button',{attrs:{\"to\":'/activity/android/' + _vm.host + '/' + _vm.previousDay(),\"variant\":\"outline-dark\"}},[_c('icon',{attrs:{\"name\":\"arrow-left\"}}),_c('span',{staticClass:\"d-none d-lg-inline\"},[_vm._v(\" Previous day\")])],1),_c('b-button',{attrs:{\"to\":'/activity/android/' + _vm.host + '/' + _vm.nextDay(),\"disabled\":_vm.nextDay() > _vm.today,\"variant\":\"outline-dark\"}},[_c('span',{staticClass:\"d-none d-lg-inline\"},[_vm._v(\" Next day\")]),_c('icon',{attrs:{\"name\":\"arrow-right\"}})],1)],1)],1),_c('div',{staticClass:\"p-1\"},[_c('input',{staticClass:\"form-control\",attrs:{\"id\":\"date\",\"type\":\"date\",\"max\":_vm.today},domProps:{\"value\":_vm.dateShort},on:{\"change\":function($event){return _vm.setDate($event.target.value)}}})]),_c('div',{staticClass:\"p-1 ml-auto\"},[_c('b-button-group',[_c('b-button',{attrs:{\"variant\":\"outline-dark\"},on:{\"click\":function($event){return _vm.refresh()}}},[_c('icon',{attrs:{\"name\":\"sync\"}}),_c('span',{staticClass:\"d-none d-lg-inline\"},[_vm._v(\" Refresh\")])],1)],1)],1)]),_c('aw-periodusage',{attrs:{\"periodusage_arr\":_vm.daily_activity,\"host\":_vm.host}}),_c('br'),_c('div',{staticClass:\"row\"},[_c('div',{staticClass:\"col-md-4\"},[_c('h5',[_vm._v(\"Top Applications\")]),_c('aw-summary',{attrs:{\"fields\":_vm.top_apps,\"namefunc\":_vm.top_apps_namefunc,\"colorfunc\":_vm.top_apps_colorfunc}}),_c('b-button',{attrs:{\"size\":\"sm\",\"variant\":\"outline-secondary\",\"disabled\":_vm.top_apps.length < _vm.top_apps_count},on:{\"click\":function($event){_vm.top_apps_count += 5; _vm.queryApps()}}},[_c('icon',{attrs:{\"name\":\"angle-double-down\"}}),_vm._v(\"Show more\")],1)],1)])],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template lang=\"pug\">\ndiv\n  h2 Activity for {{ dateShort }}\n\n  p\n    | Device type: Android\n    br\n    | Host: {{ host }}\n    br\n    | Active time: {{ total_duration | friendlyduration }}\n\n  b-alert(variant=\"danger\" :show=\"errormsg.length > 0\")\n    | {{ errormsg }}\n\n  div.d-flex\n    div.p-1\n      b-button-group\n        b-button(:to=\"'/activity/android/' + host + '/' + previousDay()\", variant=\"outline-dark\")\n          icon(name=\"arrow-left\")\n          span.d-none.d-lg-inline\n            |  Previous day\n        b-button(:to=\"'/activity/android/' + host + '/' + nextDay()\", :disabled=\"nextDay() > today\", variant=\"outline-dark\")\n          span.d-none.d-lg-inline\n            |  Next day\n          icon(name=\"arrow-right\")\n    div.p-1\n      input.form-control(id=\"date\" type=\"date\" :value=\"dateShort\" :max=\"today\" @change=\"setDate($event.target.value)\")\n\n    div.p-1.ml-auto\n      b-button-group\n        b-button(@click=\"refresh()\", variant=\"outline-dark\")\n          icon(name=\"sync\")\n          span.d-none.d-lg-inline\n            |  Refresh\n\n  aw-periodusage(:periodusage_arr=\"daily_activity\", :host=\"host\")\n\n  br\n\n  div.row\n    div.col-md-4\n      h5 Top Applications\n      aw-summary(:fields=\"top_apps\", :namefunc=\"top_apps_namefunc\", :colorfunc=\"top_apps_colorfunc\")\n      b-button(size=\"sm\", variant=\"outline-secondary\", :disabled=\"top_apps.length < top_apps_count\", @click=\"top_apps_count += 5; queryApps()\")\n        icon(name=\"angle-double-down\")\n        | Show more\n\n\n</template>\n\n<style lang=\"scss\">\n</style>\n\n<script>\nimport moment from 'moment';\nimport time from \"../util/time.js\";\nimport _ from 'lodash';\n\nimport 'vue-awesome/icons/arrow-left'\nimport 'vue-awesome/icons/arrow-right'\nimport 'vue-awesome/icons/angle-double-down'\nimport 'vue-awesome/icons/sync'\n\nimport query from '../queries.js';\n\n\nexport default {\n  name: \"Activity\",\n  data: () => {\n    return {\n      today: moment().startOf('day').format(\"YYYY-MM-DD\"),\n\n      errormsg: \"\",\n\n      // Query variables\n      total_duration: \"\",\n\n      daily_activity: [],\n\n      top_apps: [],\n      top_apps_count: 5,\n      top_apps_namefunc: (e) => e.data.app,\n      top_apps_colorfunc: (e) => e.data.app,\n\n      appBucketId: \"aw-watcher-android-test\",\n    }\n  },\n  watch: {\n    '$route': function() {\n      this.refresh();\n    },\n  },\n\n  computed: {\n    host: function() { return this.$route.params.host },\n    date: function() {\n      var dateParam = this.$route.params.date;\n      var dateMoment = dateParam ? moment(dateParam) : moment();\n      return dateMoment.startOf('day').format();\n    },\n    dateStart: function() { return this.date },\n    dateEnd: function() { return moment(this.date).add(1, 'days').format() },\n    dateShort: function() { return moment(this.date).format(\"YYYY-MM-DD\") },\n  },\n\n  mounted: function() {\n    this.refresh();\n    this.testError();\n  },\n\n  methods: {\n    previousDay: function() { return moment(this.dateStart).subtract(1, 'days').format(\"YYYY-MM-DD\") },\n    nextDay: function() { return moment(this.dateStart).add(1, 'days').format(\"YYYY-MM-DD\") },\n    setDate: function(date) { this.$router.push('/activity/android/' + this.host + '/' + date); },\n\n    refresh: function() {\n      this.queryAll();\n    },\n\n    errorHandler: function(error) {\n      this.errormsg = \"\" + error + \". See dev console (F12) and/or server logs for more info.\";\n      throw error;\n    },\n\n    queryAll: function() {\n      this.total_duration = 0;\n      this.eventcount = 0;\n      this.errormsg = \"\";\n\n      this.queryApps();\n      this.queryDailyActivity();\n    },\n\n    queryApps: async function() {\n      var periods = [this.dateStart + \"/\" + this.dateEnd];\n      var q = query.appQuery(this.appBucketId, this.top_apps_count);\n      let data = await this.$aw.query(periods, q).catch(this.errorHandler);\n      data = data[0];\n      this.top_apps = data[\"events\"];\n      this.total_duration = data[\"total_duration\"];\n    },\n\n    queryDailyActivity: async function() {\n      var timeperiods = [];\n      for (var i=-15; i<=15; i++) {\n        var startdate = moment(this.date).add(i, 'days').format();\n        var enddate = moment(this.date).add(i+1, 'days').format();\n        timeperiods.push(startdate + '/' + enddate);\n      }\n      let dur_per_date = await this.$aw.query(timeperiods, query.dailyActivityQueryAndroid(this.appBucketId)).catch(this.errorHandler);\n      // TODO: This is some nasty shit, aw-periodusage should really just accept an array with (timestamp, duration) tuples instead.\n      this.daily_activity = _.map(_.zip(timeperiods, dur_per_date), (t) => {\n        let timestamp = t[0].split(\"/\")[0];\n        let duration = t[1];\n        return [\n          {\n            \"timestamp\": timestamp,\n            \"duration\": duration,\n            \"data\": {\n              \"status\": \"not-afk\"\n            }\n          }\n        ]\n      })\n      console.log(this.daily_activity);\n    },\n\n    testError() {\n      //throw 'error: some message';\n    }\n  },\n}\n</script>\n","import mod from \"-!../../node_modules/babel-loader/lib/index.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ActivityAndroid.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/babel-loader/lib/index.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ActivityAndroid.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./ActivityAndroid.vue?vue&type=template&id=04ccf710&lang=pug&\"\nimport script from \"./ActivityAndroid.vue?vue&type=script&lang=js&\"\nexport * from \"./ActivityAndroid.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}